<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../t-shared-lib/t-provider-behavior.html">
<!--
    <h3>Details:</h3>

        `t-search-api` is a air search api component integrated with mystique apis.

        It fires mystique search call and returns `searchId` upon successful opearion

    <h3>Object Structure:</h3>

        1. This component uses following request format to search airs -

            var request = {
                productType": "Flight",
                "Passengers": [
                    {
                        "quantity": data.adult,
                        "type": "Adult",
                        "ages": []
                    },
                    {
                        "quantity": data.child,
                        "type": "Child",
                        "ages": []
                    },
                    {
                        "quantity": 0,
                        "type": "Senior",
                        "ages": []
                    },
                    {
                        "quantity": data.infant,
                        "type": "Infant",
                        "ages": []
                    }
                ],
                "legs": [
                    {
                        "departureLocation": data.DepartureAirport,
                        "includeNearByAirportsForDeparture": true,
                        "arrivalLocation": data.ArrivalAirport,
                        "includeNearByAirportsForArrival": true,
                        "travelDate": {
                            "date":  this._getFormattedDate(data.departureDate)
                        }
                    }
                ],
                "preferences": { "nonStopOnly": false, "cabinType": data.cabinType }
            };
            if (data.itineraryType === 'RoundTrip') {
                request.legs[1] = {
                    "departureLocation": data.ArrivalAirport,
                    "includeNearByAirportsForDeparture": true,
                    "arrivalLocation": data.DepartureAirport,
                    "includeNearByAirportsForArrival": true,
                    "travelDate": {
                        "date":  this._getFormattedDate(data.arrivalDate)
                    }

                };
            }

    <h3>Events:</h3>

        following events are fired by this component

            1. 't-search-api-success' - fired upon successful search call
            2. 't-search-api-error' - fired if search call is failed

    <h3>Example:</h3>

        <t-search-api 
            id="searchApi" 
            loading={{loading}} 
            api-base-url="{{apiBaseUrl}}" 
            api-relative-url="api/air/search" 
            auth-token="{{authToken}}"
            on-t-search-api-success="onSearchSuccess"
            on-t-search-api-error="onSearchError">
        </t-search-api>

    @demo demo/index.html
-->
<dom-module id="t-search-api">
    <template>
        <iron-ajax id="ajaxCall" method="POST" content-type="application/json" on-response="_successHandler" handle-as="json" on-error="_errorCallback" verbose>
        </iron-ajax>
    </template>
</dom-module>
<script>
(function() {

    Polymer({
        is: 't-search-api',

        properties: {
            /*Pass the build data for each type of search request*/
            data:{
                type: Object
            }

        },

        observers:[
            'search(data)'
        ],
        /*
         * <p>Behaviour to validate ajax parameters and handle error codes.</p>
         */
        behaviors: [TravelNxt.Behaviors.ProviderBehavior],

        /*
         * <p>Method to search airs</p>
         */
        search: function(data) {

            if (!data) {
                throw Error("search request is mandetory");
            }

            if (this._validateApiMeta()) {
                this.$.ajaxCall.url = this._getUrl();
                this.$.ajaxCall.body = JSON.stringify(data);
                this.$.ajaxCall.generateRequest();
            }
        }
    });
})();
</script>
