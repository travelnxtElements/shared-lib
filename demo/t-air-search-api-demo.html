<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="../../iron-meta/iron-meta.html">
    <link rel="import" href="../t-air-search-api.html">
</head>

<body>
    <template is="dom-bind" id="domBindTemplate">
        <h2>Air Search API Demo</h2>
        <iron-meta key="Eva.contextName" value="mystiquedemo" type="globals"></iron-meta>
        <iron-meta key="Eva.apiBaseUrl" value="http://demo.travelnxt.com/api/" type="globals"></iron-meta>
        <t-air-search-api id="searchApi" loading={{loading}}></t-air-search-api>
        <template is="dom-if" if="{{loading}}">
            <div>API in-progress, wait..</div>
        </template>
    </template>
</body>
<script>
window.addEventListener('WebComponentsReady', function(e) {
    var apiComp = document.getElementById('searchApi');

    apiComp.addEventListener(apiComp.eventName + '-api-success', function(e) {
        alert('search success - ' + e.detail.searchId)
    });
    apiComp.addEventListener(apiComp.eventName + '-api-error', function(e) {
        alert('search failed - ' + e.detail.message)
    });

    if (apiComp.isReady) {
        initiateSearch();
    } else {
        apiComp.addEventListener('t-auth-api-success', function(e) {
            initiateSearch();
        });
    }

    function initiateSearch() {
        var criteria = {
            adultCount: 1,
            adultAges: [],
            leg1Origin: 'LAS',
            leg1Destination: 'LAX',
            leg1Date: '04/25/2016',
            tripType: 'OneWay'
        };

        var event = new CustomEvent('t-air-search', {
            'detail': criteria
        });

        document.querySelector('body').dispatchEvent(event);
    }
});
</script>

</html>