<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="../../iron-meta/iron-meta.html">
    <link rel="import" href="../t-air-results-api.html">
</head>

<body>
    <template is="dom-bind" id="domBindTemplate">
        <h2>Air Results API Demo</h2>
        <iron-meta key="Eva.contextName" value="mystiquedemo" type="globals"></iron-meta>
        <iron-meta key="Eva.apiBaseUrl" value="http://demo.travelnxt.com/api/" type="globals"></iron-meta>
        <t-air-results-api id="resultsApi" loading={{loading}}></t-air-results-api>
        <template is="dom-if" if="{{loading}}">
            <div>API in-progress, wait..</div>
        </template>
    </template>
</body>
<script>
window.addEventListener('WebComponentsReady', function(e) {
    var apiComp = document.getElementById('resultsApi');
    var done = false;

    apiComp.addEventListener(apiComp.eventName + '-api-success', function(e) {
        
        if(done){
            alert('prev page results success - ' + e.detail.searchId);            
            return;
        }

        if(apiComp.currentPage == 1){            
            alert('results success - ' + e.detail.searchId);
            apiComp.getNextPage(e.detail.searchId);
        }
        if(apiComp.currentPage == 2 && apiComp.hasPrevPage){
            alert('next page results success - ' + e.detail.searchId);            
            apiComp.getPrevPage(e.detail.searchId);
            done = true
        }
    });

    apiComp.addEventListener(apiComp.eventName + '-api-error', function(e) {
        alert('results failed - ' + e.detail.message)
    });

    if (apiComp.isReady) {
        fetchResults();
    } else {
        apiComp.addEventListener('t-auth-api-success', function(e) {
            fetchResults();
        });
    }

    function fetchResults() {       
        var criteria = {
            adultCount: 1,
            adultAges: [],
            leg1Origin: 'LAS',
            leg1Destination: 'LAX',
            leg1Date: '05/25/2016',
            tripType: 'OneWay'
        };

        var event = new CustomEvent('t-air-results', {
            'detail': {
                'criteria': criteria
            }
        });

        document.querySelector('body').dispatchEvent(event);
    }
});
</script>

</html>